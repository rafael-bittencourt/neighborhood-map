/*
 Udacity FrontEndDev Neighborhood Map 2017-08-29 
*/

function makeMarkerIcon(o){return new google.maps.MarkerImage("http://chart.googleapis.com/chart?chst=d_map_spin&chld=1.15|0|"+o+"|40|_|%E2%80%A2",new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34),new google.maps.Size(21,34))}function initMap(){ko.applyBindings(new ViewModel)}function mapsError(){alert("This page was unable to display google maps element. Try again.")}var MARKER_ORIGINAL="c0b283",MARKER_BOUNCE="ffffff",map,bounds,zoomControl=!0,Location=function(o){var e=this;this.title=ko.observable(o.title),this.location=ko.observable(o.location),this.infoWindow=new google.maps.InfoWindow,this.marker=new google.maps.Marker({position:o.location,animation:google.maps.Animation.DROP,map:map,icon:makeMarkerIcon(MARKER_ORIGINAL),title:o.title}),this.onMap=ko.observable(!0),this.showMarker=ko.computed(function(){!0===e.onMap()?(e.marker.setMap(map),bounds.extend(e.marker.position)):e.marker.setMap(null),zoomControl&&map.fitBounds(bounds)},e);var t,a="https://api.foursquare.com/v2/venues/search?ll="+this.location().lat+","+this.location().lng+"&client_id=YXNTUQ4Y5AD5NHQF0WWNIAGR3H0P0CBWOV4C01WECFXAJEXZ&client_secret=IB00R5MESIZZTV5MTKNINUDLLWAD0QEZPCVUUG3MHSA0CPH3&v=20170824";$.getJSON(a).done(function(o){var a=o.response.venues[0],n=a.name?a.name:"name not available",i=a.categories[0].name?a.categories[0].name:"category not available",s=a.location.address?a.location.address:"address not available",l=a.contact.formattedPhone?a.contact.formattedPhone:"phone not available",r=a.contact.twitter?a.contact.twitter:"twitter not available",c=a.url;t="<div><h3>"+n+"</h3><h4>"+i+'</h4><ul class="list_locations"><li>Address: '+s+"</li><li>Phone: "+l+"</li><li>Twitter: "+r+"</li>",void 0!==c?t=t+'<li>URL: <a href="'+a.url+'">'+c+"</a></li></ul></div>":t+="<li>URL: webpage not available</li></ul></div>",e.infoWindow.setContent(t)}).fail(function(){alert("Foursquare data is unavailable.")}),this.triggerMarker=function(){google.maps.event.trigger(e.marker,"click")},this.marker.addListener("click",function(){e.infoWindow.open(map,this),this.setIcon(makeMarkerIcon(MARKER_BOUNCE)),this.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.marker.setIcon(makeMarkerIcon(MARKER_ORIGINAL)),e.marker.setAnimation(null)},2e3)})},ViewModel=function(){var o=this;map=new google.maps.Map(document.getElementById("map"),{center:{lat:29.9492328,lng:-90.0816677},styles:styles,zoom:14}),bounds=new google.maps.LatLngBounds,this.locationList=ko.observableArray([]),this.filter=ko.observable(""),locations.forEach(function(e){o.locationList.push(new Location(e))}),this.filteredItems=ko.computed(function(){var o=this.filter().toLowerCase();return o?ko.utils.arrayFilter(this.locationList(),function(e){if(-1!==e.title().toLowerCase().indexOf(o))return e.onMap(!0),-1!==e.title().toLowerCase().indexOf(o);e.onMap(!1)}):(ko.utils.arrayForEach(this.locationList(),function(o){o.onMap(!0)}),this.locationList())},o),google.maps.event.addListenerOnce(map,"bounds_changed",function(o){this.getZoom()&&this.setZoom(14),zoomControl=!1})};